generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

// ユーザー
model User {
  id          String    @id @default(cuid())
  lineUserId  String    @unique @map("line_user_id")
  displayName String    @map("display_name")
  pictureUrl  String?   @map("picture_url")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  bookings Booking[]

  @@map("users")
}

// 予約枠（固定枠）- シンプル化: 日付と時間のみ
model TimeSlot {
  id          String   @id @default(cuid())
  date        DateTime
  startTime   String   @map("start_time") // "10:00"
  endTime     String   @map("end_time")   // "11:00"
  maxCapacity Int      @default(1) @map("max_capacity")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")

  bookings Booking[]

  @@unique([date, startTime])
  @@index([date])
  @@map("time_slots")
}

// 予約
model Booking {
  id         String        @id @default(cuid())
  userId     String        @map("user_id")
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  timeSlotId String        @map("time_slot_id")
  timeSlot   TimeSlot      @relation(fields: [timeSlotId], references: [id])
  status     BookingStatus @default(CONFIRMED)
  notes      String?
  createdAt  DateTime      @default(now()) @map("created_at")
  updatedAt  DateTime      @updatedAt @map("updated_at")

  @@index([userId])
  @@index([status])
  @@map("bookings")
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}
